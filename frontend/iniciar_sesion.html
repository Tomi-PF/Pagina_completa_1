<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aterrizar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="styles.css"> <!-- Enlace al archivo CSS -->
</head>

<body>

    <div class="navbar">

        <nav class="navbar" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a href="index.html">
                    <img src="img/Logo.png" alt="Logo de Aterrizar" class="logo">
                </a>
            </div>

            <div class="navbar-menu">
                <div class="navbar-start">
                    <a href="index.html" class="navbar-item">Inicio</a>
                    <a href="alojamientos.html" class="navbar-item">Alojamientos</a>
                    <a href="reservas.html" class="navbar-item">Reservas</a>
                </div>

                <div class="navbar-end">
                    <a href="iniciar_sesion.html" class="navbar-item" id="in_ses">Iniciar sesión</a>
                    <a href="registrarse.html" class="navbar-item" id="reg">Registrarse</a>
                    <a href="#" class="navbar-item" id="c_ses" style="display: none;">Cerrar sesión</a>
                </div>
            </div>
        </nav>

    </div>
    
    <div class="content">    
        <h2>Iniciar sesión</h2>
        <p>Formulario para iniciar sesión</p>
    </div>
        
        
    <section class="section-reservas">
        
        <div class="contenedor-form" id="form_seccion">
            <header>Formulario para iniciar sesión</header>
            <form class="form" id="formReserva" method="post">
                
                <div class="input-box">
                    <label>Usuario</label>
                    <input type="text" name="usuario" id="usuario" placeholder="Ingrese su usuario" required>
                </div>
                
                <div class="input-box">
                    <label>Contraseña</label>
                    <input type="password" name="password" id="password" placeholder="Ingrese su contraseña" required>
                </div>
                
                <button type="submit">Iniciar sesión</button>
            </form>
        </div>

    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () =>{

            const formularioUsuario = document.getElementById('formReserva')

            formularioUsuario.addEventListener('submit', () =>{
                event.preventDefault()

                const usuario = document.getElementById('usuario').value.trim()
                const contraseña = document.getElementById('password').value.trim()

                const usuario_autenticar = {
                    usuario: usuario,
                    contraseña: contraseña
                }

                fetch('http://localhost:3000/api/v1/usuarios/', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(usuario_autenticar)
                })
                .then(response => {
                    if(!response.ok){
                        return response.json().then(errorData =>{
                            alert(errorData.error)
                            throw new Error(errorData.error || 'Error al autenticar el usuario')
                        })
                    }
                    return response.json()
                })
                .then(data => {
                    console.log("Iniciado de sesión con éxito")
                    alert("Iniciado de sesión con éxito")
                    formularioUsuario.reset()

                    const boton_inicio_sesion = document.getElementById('in_ses')
                    boton_inicio_sesion.style.display = "none"
                    const boton_registrarse = document.getElementById('reg')
                    boton_registrarse.style.display = "none"
                    const boton_cerrar_sesion = document.getElementById('c_ses')
                    boton_cerrar_sesion.style.display = "flex"
                })
            })
        })

    </script>
    
    
    <footer>
        <p>Contacto: <a href="mailto:Aterrizar@gmail.com">Aterrizar@gmail.com</a> | Teléfono: 0800-777-2354</p>
    </footer>
    

</body>
</html>
